import Student from "../models/Student.js";
import Class from "../models/Class.js";
import AttendanceRecord from "../models/AttendanceRecord.js";
import Enrollment from "../models/Enrollment.js";
import sequelize from "./AttendenceSystemDB.js";

Student.hasMany(AttendanceRecord, { foreignKey: "studentId" });
AttendanceRecord.belongsTo(Student, { foreignKey: "studentId" });

Class.hasMany(AttendanceRecord, { foreignKey: "classId" });
AttendanceRecord.belongsTo(Class, { foreignKey: "classId" });

Student.belongsToMany(Class, {
  through: Enrollment,
  foreignKey: "studentId",
  otherKey: "classId",
});
Class.belongsToMany(Student, {
  through: Enrollment,
  foreignKey: "classId",
  otherKey: "studentId",
});

await sequelize.sync();

async function insertSampleData() {
  // Create 10 students
  const students = [];
  for (let i = 1; i <= 10; i++) {
    const student = await Student.create({
      name: `Student ${i}`,
      birth_date: `2000-01-${i.toString().padStart(2, "0")}`,
    });
    students.push(student);
  }

  // Create 10 classes
  const classes = [];
  for (let i = 1; i <= 10; i++) {
    const classInstance = await Class.create({
      name: `Class ${i}`,
    });
    classes.push(classInstance);
  }

  // Create 10 enrollments with unique student-class pairs
  const enrollmentPairs = new Set();
  let enrollmentsCreated = 0;
  while (enrollmentsCreated < 10) {
    const student = students[Math.floor(Math.random() * students.length)];
    const classInstance = classes[Math.floor(Math.random() * classes.length)];
    const key = `${student.id}-${classInstance.id}`;

    if (!enrollmentPairs.has(key)) {
      await Enrollment.create({
        studentId: student.id,
        classId: classInstance.id,
      });
      enrollmentPairs.add(key);
      enrollmentsCreated++;
    }
  }

  // Create 10 attendance records with unique (studentId, classId, date)
  const attendanceKeys = new Set();
  let attendanceCreated = 0;
  while (attendanceCreated < 10) {
    const student = students[Math.floor(Math.random() * students.length)];
    const classInstance = classes[Math.floor(Math.random() * classes.length)];
    const date = `2025-06-${(attendanceCreated + 1)
      .toString()
      .padStart(2, "0")}`; // unique date per record
    const key = `${student.id}-${classInstance.id}-${date}`;

    if (!attendanceKeys.has(key)) {
      await AttendanceRecord.create({
        studentId: student.id,
        classId: classInstance.id,
        date: date,
        status: Math.random() > 0.3 ? "present" : "absent",
      });
      attendanceKeys.add(key);
      attendanceCreated++;
    }
  }

  console.log(
    "Inserted 10 students, 10 classes, 10 enrollments, and 10 attendance records."
  );
}

// Run the insertion function
insertSampleData().catch(console.error);

// Generated by ChatGPT
