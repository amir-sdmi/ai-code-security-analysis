// snippet made by chatGPT
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

let theme = localStorage.getItem('theme');
if (!theme) {
  theme = prefersDark ? 'dark' : 'light';
}

document.documentElement.setAttribute('data-theme', theme);
// Later allow user to toggle
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  const newTheme = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
}
// snipper made by chatGPT

// function made by chatgpt!
document.addEventListener("htmx:afterRequest", function(evt) {
    if (evt.detail.xhr.getResponseHeader("HX-Location")) {
        setTimeout(() => {
            window.location.reload(); // Forces full reload after redirect
        }, 100); // Small delay to ensure redirection is processed
    }
});

//function made by chatgpt!
function handleResponse(event) {
    let xhr = event.detail.xhr;
    let status = xhr.getResponseHeader("HX-Status");
    let message = xhr.getResponseHeader("HX-Message");
    
    // mainly use for panel changes, when there's no need to reload
    if (status == "202") {
        return ;
    } else if (status == "201") {
        setTimeout(() => {
            window.location.reload(); // Forces full reload after redirect
        }, 100); // Small delay to ensure redirection is processed
        alert(message);
    } else if (status == "200") {
        alert(message);
    } else if (status == "400") {
        alert(message);
    } else if (status == "500") {
        alert(message);
    } else {
        alert("Something went wrong. Please try again.");
    }
}

// function made by chatgpt!
function validateForm(event) {
    const form = event.target.closest("form");
    if (!form.checkValidity()) {
        alert("Please finish filling the form! Check if you miss any required ('*') field!");
        event.preventDefault(); // Prevent HTMX from sending request
        form.reportValidity(); // Show default validation messages
    }
}

function validateRegister(event) {
    const confPass = document.getElementsByName("confirm-password")[0];
    const pass = document.getElementsByName("password")[0];

    if (confPass.value !== pass.value) {
        alert("Passwords don't match, please try again!")
        event.preventDefault();
        return;
    }

    validateForm(event)
}

// code generated by chatgpt!
function changeImage(file) {
    const imgPreview = document.getElementById("image-container");
    if (file) {
        imgPreview.src = URL.createObjectURL(file); // Set the image preview
        imgPreview.onload = function () {
            URL.revokeObjectURL(imgPreview.src); // Free memory once loaded
        };
    } else {
        imgPreview.src = "https://ik.imagekit.io/FilmPost/default_pfp.png?updatedAt=1743482764769";
    }
}

function revealPass(element) {
    const passInput = element.previousElementSibling;

    if (passInput.type === "password") {
        passInput.type = "text";
        element.classList.remove("fa-eye");
        element.classList.add("fa-eye-slash");
    } else if (passInput.type === "text") {
        passInput.type = "password";
        element.classList.add("fa-eye");
        element.classList.remove("fa-eye-slash");
    }

}


function showMovieOptions() {
    const poster = document.getElementById("poster-selector") ;
    const seriesNameDiv = document.getElementById("series-name-div");
    const seriesNameInput = document.getElementById("series-name");
    const contentName = document.getElementById("content-name");
    const imgContainer = document.getElementById("image-container");
    const headerText = document.getElementsByClassName("ft-lobster");
    const posterSelector = document.getElementById("poster-selector");
    const imageSelected = document.getElementById("image-hidden");

    seriesNameInput.value = "";
    imageSelected.value = "";
    posterSelector.selectedIndex = 0;
    headerText[0].innerText = "Register movie";
    imgContainer.src = "/backend/imgs/movies.svg"
    contentName.innerText = "Movie name*:";
    seriesNameDiv.style.display = "none";
    poster.style.display = "none";
}

function showSeriesOptions() {
    const poster = document.getElementById("poster-selector");
    const seriesNameDiv = document.getElementById("series-name-div");
    const seriesNameInput = document.getElementById("series-name");
    const contentName = document.getElementById("content-name");
    const imgContainer = document.getElementById("image-container");
    const headerText = document.getElementsByClassName("ft-lobster");
    const posterSelector = document.getElementById("poster-selector");
    const imageSelected = document.getElementById("image-hidden");
    
    seriesNameInput.value = "";
    imageSelected.value = ""; // this will reset the file
    posterSelector.selectedIndex = 0;
    headerText[0].innerText = "Register episode";
    imgContainer.src = "/backend/imgs/series.svg";
    contentName.innerText = "Episode name*:";
    seriesNameDiv.style.display = "flex";
    poster.style.display = "flex";
}

function setSelectedPoster(posterUrl) {
    const seriesNameInput = document.getElementById("series-name");
    const imgContainer = document.getElementById("image-container");
    const posterSelector = document.getElementById("poster-selector");
    
    if (posterSelector.selectedIndex === 0) {
        seriesNameInput.readOnly = true;
        seriesNameInput.value = ""
    } else {
        seriesNameInput.readOnly = false;
        seriesNameInput.value = posterSelector.value
    }
    imgContainer.src = posterUrl;
}

function changePoster() {
    if (document.getElementById("poster-selector").selectedIndex === 0) {
        document.getElementById('image-hidden').click()
    }
}

function changeStars(stars) {
    const ratingBtns = document.getElementsByName("rating-btn"); 
    const rating = document.getElementsByName("rating")[0];
    
    if (rating.value == stars) {
        stars = 0;
    }

    for (let i = 0; i < ratingBtns.length; i++) {
        if (i < stars) {
            ratingBtns[i].classList.remove("free-rating-btn");
            ratingBtns[i].classList.add("selected-rating-btn");
        } else {
            ratingBtns[i].classList.add("free-rating-btn");
            ratingBtns[i].classList.remove("selected-rating-btn");
        }
    }

    rating.value = stars;
}

function showMovieTable() {
    const movieTable = document.getElementById("movie-table")
    const seriesTable = document.getElementById("series-table")

    movieTable.classList.remove("hidden-component")
    seriesTable.classList.add("hidden-component")
}

function showSeriesTable() {
    const movieTable = document.getElementById("movie-table")
    const seriesTable = document.getElementById("series-table")

    seriesTable.classList.remove("hidden-component")
    movieTable.classList.add("hidden-component")
}

