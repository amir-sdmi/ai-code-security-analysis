// tests/openaiService.test.js
// Generated by Copilot
const openai = require('../src/services/openaiService');
const axios = require('axios');

jest.mock('axios');

describe('openaiService', () => {
  let mockPost;

  beforeEach(() => {
    mockPost = jest.fn();
    axios.create.mockReturnValue({ post: mockPost });
  });

  afterEach(() => {
    jest.clearAllMocks();
    jest.resetModules();
  });

  test('should generate text using OpenAI', async () => {
    mockPost.mockResolvedValue({
      data: { choices: [{ text: '¡Hola!' }] }
    });
    const prompt = "Hello, how are you?";
    const response = await openai.generateText(prompt);
    expect(response).toBe('¡Hola!');
  });

  test('should throw error when OpenAI API fails', async () => {
    mockPost.mockRejectedValue(new Error('API error'));
    await expect(openai.generateText('Test')).rejects.toThrow('API error');
  });

  test('should use custom model and max_tokens', async () => {
    mockPost.mockResolvedValue({
      data: { choices: [{ text: 'Custom!' }] }
    });
    const response = await openai.generateText('Test', 'custom-model', 50);
    expect(response).toBe('Custom!');
    expect(mockPost).toHaveBeenCalledWith(
      '/completions',
      {
        model: 'custom-model',
        prompt: 'Test',
        max_tokens: 50
      }
    );
  });
});
// Generated by Copilot

