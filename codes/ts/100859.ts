// This file is generated by Gemini.
'use server';
/**
 * @fileOverview Investment idea generator AI agent.
 *
 * - generateInvestmentIdea - A function that generates investment ideas.
 * - InvestmentIdeaInput - The input type for the generateInvestmentIdea function.
 * - InvestmentIdeaOutput - The return type for the generateInvestmentIdea function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const InvestmentIdeaInputSchema = z.object({
  marketTrends: z.string().describe('Current market trends to consider.'),
  referenceUrls: z
    .array(z.string().url())
    .optional()
    .describe('Optional URLs to filter investment ideas by.'),
});
export type InvestmentIdeaInput = z.infer<typeof InvestmentIdeaInputSchema>;

const InvestmentIdeaOutputSchema = z.object({
  investmentIdea: z.string().describe('A new investment idea for stocks or cryptocurrencies.'),
  reasoning: z.string().describe('The reasoning behind the investment idea.'),
});
export type InvestmentIdeaOutput = z.infer<typeof InvestmentIdeaOutputSchema>;

export async function generateInvestmentIdea(input: InvestmentIdeaInput): Promise<InvestmentIdeaOutput> {
  return investmentIdeaFlow(input);
}

const investmentIdeaPrompt = ai.definePrompt({
  name: 'investmentIdeaPrompt',
  input: {schema: InvestmentIdeaInputSchema},
  output: {schema: InvestmentIdeaOutputSchema},
  prompt: `You are a financial analyst generating investment ideas for stocks and cryptocurrencies.

  Consider the following market trends:
  {{marketTrends}}

  {{~#if referenceUrls}}
  Only consider investment opportunities that have been featured in the following URLs:
  {{~#each referenceUrls}}
  - {{this}}
  {{~/each}}
  {{~/if}}

  Generate a new investment idea and explain your reasoning. Remember that this is for informational purposes only, and the user should always do their own due diligence.
  Investment Idea:
  {{investmentIdea}}

  Reasoning:
  {{reasoning}}`,
});

const investmentIdeaFlow = ai.defineFlow(
  {
    name: 'investmentIdeaFlow',
    inputSchema: InvestmentIdeaInputSchema,
    outputSchema: InvestmentIdeaOutputSchema,
  },
  async input => {
    const {output} = await investmentIdeaPrompt(input);
    return output!;
  }
);
